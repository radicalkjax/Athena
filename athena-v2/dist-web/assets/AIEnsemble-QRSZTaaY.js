var fe=Object.defineProperty;var ve=(v,s,e)=>s in v?fe(v,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):v[s]=e;var g=(v,s,e)=>ve(v,typeof s!="symbol"?s+"":s,e);import{c as M,q as ye,t as k,i as o,m as T,a as D,S as B,F as be,b as U,e as j,g as we}from"./vendor-solid-B-ykKXyV.js";import{i as $e,a as L}from"./index-UCtE3PH6.js";import"./vendor-BrNNPIVf.js";class xe{constructor(s,e={}){g(this,"queue",[]);g(this,"processing",!1);g(this,"batchSize");g(this,"delay");g(this,"processFn");g(this,"timer",null);this.processFn=s,this.batchSize=e.batchSize||50,this.delay=e.delay||100}add(s){this.queue.push(s),this.scheduleProcess()}addMany(s){this.queue.push(...s),this.scheduleProcess()}scheduleProcess(){this.timer===null&&(this.timer=window.setTimeout(()=>{this.timer=null,this.process()},this.delay))}async process(){if(!(this.processing||this.queue.length===0)){for(this.processing=!0;this.queue.length>0;){const s=this.queue.splice(0,this.batchSize);await this.processFn(s)}this.processing=!1}}flush(){return this.timer!==null&&(clearTimeout(this.timer),this.timer=null),this.process()}}class _e{constructor(s=300*1e3){g(this,"cache",new Map);g(this,"defaultTTL");this.defaultTTL=s}set(s,e,i){const t=Date.now()+(i||this.defaultTTL);this.cache.set(s,{value:e,expiry:t})}get(s){const e=this.cache.get(s);if(e){if(Date.now()>e.expiry){this.cache.delete(s);return}return e.value}}has(s){return this.get(s)!==void 0}delete(s){this.cache.delete(s)}clear(){this.cache.clear()}cleanup(){const s=Date.now();for(const[e,i]of this.cache.entries())s>i.expiry&&this.cache.delete(e)}}class Se{constructor(){g(this,"providers",new Map);g(this,"activeRequests",new Map);g(this,"requestCache",new _e(600*1e3));g(this,"batchProcessor");g(this,"requestQueue",new Map);this.initializeProviders(),this.batchProcessor=new xe(async s=>{const e=s.map(async i=>{try{const t=await this.processSingleRequest(i),n=this.requestQueue.get(i.fileHash);n&&(n(t),this.requestQueue.delete(i.fileHash))}catch(t){console.error("Batch processing error:",t)}});await Promise.all(e)},{batchSize:5,delay:200})}initializeProviders(){[{id:"claude",name:"Claude 3",enabled:!0,model:"claude-3-opus-20240229",maxTokens:4e3,temperature:.2},{id:"gpt4",name:"GPT-4",enabled:!0,model:"gpt-4-turbo-preview",maxTokens:4e3,temperature:.2},{id:"deepseek",name:"DeepSeek",enabled:!0,model:"deepseek-coder",maxTokens:4e3,temperature:.2},{id:"gemini",name:"Gemini Pro",enabled:!0,model:"gemini-pro",maxTokens:4e3,temperature:.2},{id:"mistral",name:"Mistral",enabled:!0,model:"mistral-large-latest",maxTokens:4e3,temperature:.2},{id:"llama",name:"Llama 3",enabled:!0,model:"llama-3-70b",maxTokens:4e3,temperature:.2}].forEach(e=>{this.providers.set(e.id,e)})}async analyzeWithProvider(s,e){const i=`${s}-${e.fileHash}-${e.analysisType||"comprehensive"}`,t=this.requestCache.get(i);if(t)return t;const n=this.providers.get(s);if(!n||!n.enabled)throw new Error(`Provider ${s} is not available or enabled`);const r=`${s}-${e.fileHash}-${Date.now()}`,c=new AbortController;this.activeRequests.set(r,c);try{const p={provider:n.id,model:n.model,api_key:"",max_tokens:n.maxTokens,temperature:n.temperature},S={...await $e("analyze_with_ai",{provider:s,config:p,request:{file_hash:e.fileHash,file_path:e.filePath,file_type:e.fileType,analysis_type:e.analysisType||"comprehensive",content:e.content}}),provider:s,timestamp:Date.now()};return this.requestCache.set(i,S),S}catch(p){throw console.error(`AI analysis failed for ${s}:`,p),p}finally{this.activeRequests.delete(r)}}async processSingleRequest(s){const e=Array.from(this.providers.entries()).filter(([t,n])=>n.enabled).map(([t])=>t);if(e.length===0)throw new Error("No AI providers available");const i=e[0];if(!i)throw new Error("No AI providers available");return this.analyzeWithProvider(i,s)}async analyzeWithMultipleProviders(s){const i=s.providers.filter(t=>{const n=this.providers.get(t);return n&&n.enabled}).map(t=>this.analyzeWithProvider(t,s).catch(n=>({provider:t,timestamp:Date.now(),confidence:0,threatLevel:"safe",signatures:[],behaviors:[],iocs:{domains:[],ips:[],files:[],registry:[],processes:[]},recommendations:[],error:n.message})));return Promise.all(i)}async analyzeWithMultipleProvidersWithProgress(s,e){const i=s.providers.filter(r=>{const c=this.providers.get(r);return c&&c.enabled}),t=[],n=i.length;for(let r=0;r<i.length;r++){const c=i[r];if(!c)continue;const p=r/n*100;e&&e(c,p);try{const f=await this.analyzeWithProvider(c,s);t.push(f),e&&e(c,(r+1)/n*100)}catch(f){t.push({provider:c,timestamp:Date.now(),confidence:0,threatLevel:"safe",signatures:[],behaviors:[],iocs:{domains:[],ips:[],files:[],registry:[],processes:[]},recommendations:[],error:f.message})}}return t}cancelAnalysis(s){for(const[e,i]of this.activeRequests.entries())e.includes(s)&&(i.abort(),this.activeRequests.delete(e))}getProviderStatus(s){const e=this.providers.get(s);return e?e.enabled:!1}updateProviderConfig(s,e){const i=this.providers.get(s);i&&this.providers.set(s,{...i,...e})}getAllProviders(){return Array.from(this.providers.values())}async analyzeWithEnsemble(s,e="voting",i){switch(e){case"single-fallback":return this.singleWithFallback(s,i);case"voting":return this.ensembleVoting(s,i);case"sequential":return this.sequentialEnhancement(s,i);case"specialized":return this.specializedRouting(s,i);default:return this.ensembleVoting(s,i)}}async singleWithFallback(s,e){const i=s.providers[0]??"claude";try{const t=await this.analyzeWithProvider(i,s);return{consensus:t,individual:[t]}}catch{for(const n of s.providers.slice(1))try{const r=await this.analyzeWithProvider(n,s);return{consensus:r,individual:[r]}}catch{continue}throw new Error("All providers failed")}}async ensembleVoting(s,e){var y,$,w;const i=await this.analyzeWithMultipleProvidersWithProgress(s,e),t=new Map,n=new Map,r=new Set,c=new Set;let p=0,f=0;i.forEach(l=>{if(l.confidence>0){f++,p+=l.confidence;const m=l.confidence;t.set(l.threatLevel,(t.get(l.threatLevel)||0)+m),l.malwareFamily&&n.set(l.malwareFamily,(n.get(l.malwareFamily)||0)+m),l.signatures.forEach(x=>r.add(x)),l.behaviors.forEach(x=>c.add(x))}});const S=((y=[...t.entries()].sort((l,m)=>m[1]-l[1])[0])==null?void 0:y[0])??"safe",h=($=[...n.entries()].sort((l,m)=>m[1]-l[1])[0])==null?void 0:$[0];return{consensus:{provider:"ensemble",timestamp:Date.now(),confidence:f>0?p/f:0,threatLevel:S,malwareFamily:h,malwareType:(w=i[0])==null?void 0:w.malwareType,signatures:Array.from(r),behaviors:Array.from(c),iocs:this.mergeIOCs(i),recommendations:this.generateRecommendations(S)},individual:i}}async sequentialEnhancement(s,e){const i=[];let t={...s};for(let r=0;r<s.providers.length;r++){const c=s.providers[r];if(!c)continue;const p=r/s.providers.length*100;e&&e(c,p);const f=await this.analyzeWithProvider(c,t);i.push(f),e&&e(c,(r+1)/s.providers.length*100),t={...t,content:`${t.content}

Previous analysis:
${JSON.stringify(f,null,2)}`}}const n=i[i.length-1];if(!n)throw new Error("No analysis results generated");return{consensus:n,individual:i}}async specializedRouting(s,e){const t={pe:["claude","gpt4"],elf:["deepseek","mistral"],macho:["gemini","llama"],script:["gpt4","claude"],document:["gemini","gpt4"]}[s.fileType]||s.providers,n={...s,providers:t};return this.ensembleVoting(n,e)}mergeIOCs(s){const e={domains:new Set,ips:new Set,files:new Set,registry:new Set,processes:new Set};return s.forEach(i=>{i.iocs.domains.forEach(t=>e.domains.add(t)),i.iocs.ips.forEach(t=>e.ips.add(t)),i.iocs.files.forEach(t=>e.files.add(t)),i.iocs.registry.forEach(t=>e.registry.add(t)),i.iocs.processes.forEach(t=>e.processes.add(t))}),{domains:Array.from(e.domains),ips:Array.from(e.ips),files:Array.from(e.files),registry:Array.from(e.registry),processes:Array.from(e.processes)}}generateRecommendations(s){return{safe:["File appears benign","Continue monitoring for behavioral changes","Maintain regular security scans"],suspicious:["Isolate file for further analysis","Run in controlled sandbox environment","Check for similar samples in threat databases","Monitor system for unusual behavior"],malicious:["Immediately isolate infected system","Run comprehensive malware removal","Check network for lateral movement","Review security logs for indicators of compromise","Update security signatures and rules"],critical:["CRITICAL: Disconnect system from network immediately","Initiate incident response procedures","Preserve system state for forensic analysis","Check all connected systems for compromise","Notify security team and management","Consider full system rebuild after analysis"]}[s]}}const Pe=new Se;var Ce=k("<div class=ensemble-consensus style=margin-bottom:20px><div style=display:flex;justify-content:space-between;align-items:center;margin-bottom:10px><div class=consensus-score>% Consensus</div><div style=color:var(--success-color);font-weight:600>/<!> Providers Agreement</div></div><div style=color:var(--text-secondary)><strong>Final Classification:</strong> "),Re=k('<div class=content-panel><h2 style=color:var(--barbie-pink);margin-bottom:20px>ğŸ¤– AI Provider Ensemble Analysis</h2><div class=analysis-grid><div class=analysis-main><div class=analysis-panel><div class=panel-header><h3 class=panel-title><span aria-hidden=true>ğŸ§ </span>AI Provider Insights</h3></div><div class=panel-content><div style=display:grid;gap:15px></div></div></div></div><div class=ensemble-results><h3 style=color:var(--barbie-pink);margin-bottom:15px>ğŸ“Š Ensemble Metrics</h3><div class=stats-overview style=grid-template-columns:1fr><div class=stat-card><div class=stat-value></div><div class=stat-label>Final Confidence</div></div><div class=stat-card><div class=stat-value></div><div class=stat-label>Provider Agreement</div></div><div class=stat-card><div class=stat-value></div><div class=stat-label>Disagreements</div></div></div><h3 style="color:var(--barbie-pink);margin:20px 0 15px">ğŸ¯ Generated Artifacts</h3><div style=display:flex;flex-direction:column;gap:10px><button class="btn btn-primary">ğŸ“ Download YARA Rules</button><button class="btn btn-secondary">ğŸš¨ Export IOCs</button><button class="btn btn-secondary">ğŸ“Š Generate Report</button><button class="btn btn-secondary">ğŸ”„ '),Ae=k('<div style="background:rgba(255, 107, 107, 0.1);border:1px solid var(--danger-color);padding:10px;border-radius:8px;margin-bottom:20px"><strong style=color:var(--danger-color)>Error:</strong> '),ze=k("<div style=text-align:center;padding:40px;color:var(--text-secondary)>"),Te=k('<div><h4> <!> - <!>% Confidence</h4><p style="color:var(--text-secondary);font-size:0.9rem;margin:0 0 8px 0"><strong>Threat Level:</strong> <!> |<strong>Family:</strong> <!> |<strong>Type:</strong> </p><p style="color:var(--text-secondary);font-size:0.85rem;margin:0 0 8px 0"><strong>Signatures:</strong> </p><p style=color:var(--text-secondary);font-size:0.85rem;margin:0><strong>Recommendations:</strong> ');const Me=()=>{const[v,s]=M(!1),[e,i]=M(null),[t]=M(["claude","gpt4","deepseek","gemini","mistral","llama"]),[n,r]=M(null),c=[{id:"claude",name:"Claude 3.5 Sonnet",icon:"ğŸ¤–"},{id:"gpt4",name:"GPT-4 Turbo",icon:"ğŸ§ "},{id:"deepseek",name:"DeepSeek V3",icon:"ğŸ”"},{id:"gemini",name:"Gemini Pro",icon:"ğŸŒŸ"},{id:"mistral",name:"Claude 3 Opus",icon:"ğŸ’"},{id:"llama",name:"GPT-4o",icon:"âš¡"}];ye(()=>{L.currentFile&&e()&&(i(null),r(null))});const p=async()=>{const h=L.currentFile;if(!h){r("Please upload a file to analyze");return}s(!0),r(null);try{const d=await Pe.analyzeWithEnsemble({fileHash:h.hash,fileName:h.name,filePath:h.path,fileSize:h.size,fileType:h.type,analysisType:"comprehensive",providers:t(),priority:"high"},"voting"),y={id:`ensemble-${h.hash}-${Date.now()}`,fileHash:h.hash,timestamp:Date.now(),providers:t(),individualResults:d.individual,consensusResult:{confidence:d.consensus.confidence,threatLevel:d.consensus.threatLevel,malwareFamily:d.consensus.malwareFamily,malwareType:d.consensus.malwareType,aggregatedSignatures:d.consensus.signatures,aggregatedBehaviors:d.consensus.behaviors,aggregatedIocs:d.consensus.iocs,summary:`${d.consensus.malwareFamily||"Unknown"} - ${d.consensus.malwareType||"Suspicious"}`},disagreements:f(d.individual)};i(y),L.updateProgress({aiAnalysis:{status:"completed",progress:100,result:y.consensusResult}})}catch(d){r(d instanceof Error?d.message:"Analysis failed")}finally{s(!1)}},f=h=>{const d=[],y=["threatLevel","malwareFamily","malwareType"];for(const $ of y){const w=new Map;if(h.forEach(l=>{const m=l[$]||"unknown",x=w.get(m)||[];x.push(l.provider),w.set(m,x)}),w.size>1)for(const[l,m]of w)m.length===1&&d.push({provider:m[0],field:$,value:l})}return d},S={claude:"#74b9ff",gpt4:"#fd79a8",deepseek:"#e17055",gemini:"#00b894",mistral:"#fdcb6e",llama:"#6c5ce7"};return(()=>{var h=Re(),d=h.firstChild,y=d.nextSibling,$=y.firstChild,w=$.firstChild,l=w.firstChild,m=l.nextSibling,x=m.firstChild,Q=$.nextSibling,J=Q.firstChild,N=J.nextSibling,G=N.firstChild,K=G.firstChild,H=G.nextSibling,Y=H.firstChild,X=H.nextSibling,Z=X.firstChild,ee=N.nextSibling,se=ee.nextSibling,ie=se.firstChild,te=ie.nextSibling,ne=te.nextSibling,E=ne.nextSibling;return E.firstChild,o(h,(()=>{var a=T(()=>!!n());return()=>a()&&(()=>{var u=Ae(),_=u.firstChild;return _.nextSibling,o(u,n,null),u})()})(),y),o(h,D(B,{get when(){return e()},get children(){var a=Ce(),u=a.firstChild,_=u.firstChild,P=_.firstChild,b=_.nextSibling,R=b.firstChild,A=R.nextSibling;A.nextSibling;var F=u.nextSibling,I=F.firstChild;return I.nextSibling,o(_,()=>Math.round(e().consensusResult.confidence*100),P),o(b,()=>e().individualResults.filter(C=>C.confidence>0).length,R),o(b,()=>e().providers.length,A),o(F,()=>e().consensusResult.summary,null),a}}),y),o(x,D(B,{get when(){return e()},get fallback(){return(()=>{var a=ze();return o(a,()=>v()?"Analyzing with AI providers...":'No analysis results yet. Click "Run Analysis" to start.'),a})()},get children(){return D(be,{get each(){return e().individualResults},children:a=>{const u=c.find(P=>P.id===a.provider),_=S[a.provider]||"#74b9ff";return(()=>{var P=Te(),b=P.firstChild,R=b.firstChild,A=R.nextSibling,F=A.nextSibling,I=F.nextSibling;I.nextSibling;var C=b.nextSibling,re=C.firstChild,ae=re.nextSibling,V=ae.nextSibling,le=V.nextSibling,oe=le.nextSibling,ce=oe.nextSibling,O=ce.nextSibling,de=O.nextSibling,he=de.nextSibling;he.nextSibling;var W=C.nextSibling,ue=W.firstChild;ue.nextSibling;var q=W.nextSibling,me=q.firstChild;return me.nextSibling,o(b,()=>u==null?void 0:u.icon,R),o(b,()=>u==null?void 0:u.name,A),o(b,()=>Math.round(a.confidence*100),I),o(C,()=>a.threatLevel,V),o(C,()=>a.malwareFamily||"Unknown",O),o(C,()=>a.malwareType||"Unknown",null),o(W,()=>a.signatures.slice(0,3).join(", ")||"None detected",null),o(q,()=>a.recommendations.slice(0,2).join(". "),null),U(z=>{var ge=`background: var(--code-bg); padding: 15px; border-radius: 6px; border-left: 4px solid ${_};`,pe=`color: ${_}; margin-bottom: 8px;`;return z.e=j(P,ge,z.e),z.t=j(b,pe,z.t),z},{e:void 0,t:void 0}),P})()}})}})),o(K,(()=>{var a=T(()=>!!e());return()=>a()?`${Math.round(e().consensusResult.confidence*100)}%`:"0%"})()),o(Y,(()=>{var a=T(()=>!!e());return()=>a()?`${e().individualResults.filter(u=>u.confidence>0).length}/${e().providers.length}`:"0/0"})()),o(Z,(()=>{var a=T(()=>!!(e()&&e().disagreements.length>0));return()=>a()?e().disagreements.length:"0"})()),E.$$click=p,o(E,(()=>{var a=T(()=>!!v());return()=>a()?"Analyzing...":e()?"Rerun Analysis":"Run Analysis"})(),null),U(()=>E.disabled=v()||!L.currentFile),h})()};we(["click"]);export{Me as default};
