var it=Object.defineProperty;var at=(o,n,a)=>n in o?it(o,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[n]=a;var Me=(o,n,a)=>at(o,typeof n!="symbol"?n+"":n,a);import{h as Je,c as v,o as lt,u as ct,t as W,i as f,a as N,F as U,S as Y,b as F,l as q,s as De,m as dt,d as G,v as ut,w as Fe,g as pt}from"./vendor-solid-B-ykKXyV.js";import{l as ft,i as B}from"./vendor-BrNNPIVf.js";import{a as ae}from"./index-UCtE3PH6.js";class j extends Error{constructor(n,a,c){super(`Validation failed for '${n}': expected ${a}, got ${c}`),this.field=n,this.expected=a,this.received=c,this.name="ValidationError"}}function te(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function ue(o){return Array.isArray(o)}function X(o,n){if(typeof o!="string")throw new j(n,"string",typeof o);return o}function gt(o,n){if(typeof o!="number"||isNaN(o))throw new j(n,"number",typeof o);return o}function Ie(o,n,a){if(typeof o!="string"||!a.includes(o))throw new j(n,`one of [${a.join(", ")}]`,String(o));return o}function le(o){if(!te(o))throw new j("job","object",typeof o);const n=["Pending","Running","Completed","Failed","Cancelled"];return{id:X(o.id,"job.id"),workflow_type:X(o.workflow_type,"job.workflow_type"),status:Ie(o.status,"job.status",n),progress:gt(o.progress,"job.progress"),created_at:X(o.created_at,"job.created_at"),started_at:typeof o.started_at=="string"?o.started_at:void 0,completed_at:typeof o.completed_at=="string"?o.completed_at:void 0,input:te(o.input)?o.input:{},output:te(o.output)?o.output:void 0,error:typeof o.error=="string"?o.error:void 0,logs:ue(o.logs)?mt(o.logs):[]}}function mt(o){const n=["Info","Warning","Error"];return o.map((a,c)=>{if(!te(a))throw new j(`logs[${c}]`,"object",typeof a);return{timestamp:X(a.timestamp,`logs[${c}].timestamp`),level:Ie(a.level,`logs[${c}].level`,n),message:X(a.message,`logs[${c}].message`)}})}class ht{constructor(){Me(this,"progressListeners",new Map);ft("job-progress",n=>{const a=n.payload,c=this.progressListeners.get(a.job_id);c&&c(a)})}async startJob(n,a){try{const c=await B("start_job",{workflowType:n,input:a});if(typeof c!="string")throw new j("startJob.response","string",typeof c);return c}catch(c){throw console.error("Failed to start job:",c),c}}async getJobStatus(n){try{const a=await B("get_job_status",{jobId:n});return le(a)}catch(a){throw console.error("Failed to get job status:",a),a}}async listJobs(n,a){try{const c=await B("list_jobs",{status:n,limit:a});if(!ue(c))throw new j("listJobs.response","array",typeof c);return c.map((M,T)=>{try{return le(M)}catch{throw new j(`listJobs[${T}]`,"Job",typeof M)}})}catch(c){throw console.error("Failed to list jobs:",c),c}}async cancelJob(n){try{await B("cancel_job",{jobId:n})}catch(a){throw console.error("Failed to cancel job:",a),a}}async deleteJob(n){try{await B("delete_job",{jobId:n})}catch(a){throw console.error("Failed to delete job:",a),a}}async getActiveJobs(){try{const n=await B("get_active_jobs");if(!ue(n))throw new j("getActiveJobs.response","array",typeof n);return n.map((a,c)=>{try{return le(a)}catch{throw new j(`getActiveJobs[${c}]`,"Job",typeof a)}})}catch(n){throw console.error("Failed to get active jobs:",n),n}}onProgress(n,a){return this.progressListeners.set(n,a),()=>{this.progressListeners.delete(n)}}}const ce=new ht;var yt=W("<div class=workflows-list>"),wt=W("<div class=custom-workflows><div class=workflows-header><h2>Custom Workflows</h2><button class=primary-button>â• New Workflow"),$t=W('<button style="margin-bottom:10px;padding:5px 10px;background:#666;color:white;border:none;border-radius:4px;cursor:pointer;font-size:12px;width:100%">Cancel Selection'),bt=W("<div class=node-config><h3>Node Configuration</h3><p>Selected: </p><pre>"),vt=W('<div class=workflow-designer><div class=designer-header><input type=text placeholder="Workflow Name"class=workflow-name-input><div class=designer-actions><button class=save-button>ğŸ’¾ Save</button><button class=cancel-button>âŒ Cancel</button></div></div><div class=designer-content><div class=nodes-palette><h3>Analysis Nodes</h3><p style=font-size:12px;color:#888;margin-bottom:10px></p><p style=font-size:12px;color:var(--barbie-pink);margin-bottom:10px>Nodes on canvas: </p><div class=node-category></div><h3>Conditions</h3><div class=node-category></div><h3>Actions</h3><div class=node-category></div></div><div><svg class=connections-svg>'),de=W("<div><span class=node-icon></span><span class=node-name>"),xt=W("<svg><path stroke=#ff6b9d stroke-width=2 fill=none stroke-linecap=round></svg>",!1,!0,!1),_t=W('<div><div class="connector connector-top"title="Top connector"></div><div class="connector connector-right"title="Right connector"></div><div class="connector connector-bottom"title="Bottom connector"></div><div class="connector connector-left"title="Left connector"></div><div class=node-header><span></span><button class=delete-node>Ã—</button></div><div class=node-body><span class=node-type-badge>'),kt=W("<div class=workflow-execution-status><div class=execution-message></div><div class=execution-progress-bar><div class=execution-progress-fill></div></div><div class=execution-progress-text>%"),St=W("<div class=workflow-card><h3></h3><p></p><div class=workflow-stats><span>ğŸ“Š <!> nodes</span><span>ğŸ”— <!> connections</span></div><div class=workflow-actions><button class=edit-button>âœï¸ Edit</button><button class=run-button>â–¶ï¸ Run");const Ct=[{type:"static",name:"Static Analysis",icon:"ğŸ”"},{type:"yara",name:"YARA Scanner",icon:"ğŸ¯"},{type:"wasm",name:"WASM Analysis",icon:"âš¡"},{type:"ai",name:"AI Analysis",icon:"ğŸ¤–"},{type:"network",name:"Network Analysis",icon:"ğŸŒ"},{type:"behavioral",name:"Behavioral Analysis",icon:"ğŸ”¬"}],Ee=[{type:"threshold",name:"Score Threshold",icon:"ğŸ“Š"},{type:"pattern",name:"Pattern Match",icon:"ğŸ”"},{type:"time",name:"Time Condition",icon:"â°"}],Te=[{type:"alert",name:"Send Alert",icon:"ğŸš¨"},{type:"quarantine",name:"Quarantine File",icon:"ğŸ”’"},{type:"report",name:"Generate Report",icon:"ğŸ“„"},{type:"api",name:"API Call",icon:"ğŸ”Œ"}],Wt=()=>{const[o,n]=Je([]),[a,c]=v(!1),[M,T]=v([]),[oe,Q]=v([]),[pe,ne]=v("New Workflow"),[Re,fe]=v(""),[ge,H]=Je({id:"",name:"",description:"",nodes:[],connections:[],createdAt:new Date,updatedAt:new Date}),[K,me]=v(null),[,he]=v(!1),[Le,ye]=v(null),[we,I]=v(null),[$e,J]=v(0),[Oe,x]=v(""),[E,se]=v(null),[be,ve]=v(null),[Ue,Be]=v({x:0,y:0});let R;lt(()=>{He()});const He=()=>{const t=localStorage.getItem("athena-workflows");if(t)try{const s=JSON.parse(t);if(!Array.isArray(s))console.warn("Invalid workflows format: expected array"),localStorage.removeItem("athena-workflows");else{const e=s.filter(d=>{if(typeof d!="object"||d===null)return!1;const p=d;return typeof p.id=="string"&&typeof p.name=="string"&&Array.isArray(p.nodes)});n(e);return}}catch(s){console.warn("Failed to parse saved workflows:",s),localStorage.removeItem("athena-workflows")}n([{id:"default-malware",name:"Malware Detection",description:"Comprehensive malware analysis workflow",nodes:[{id:"node1",type:"analysis",name:"Static Analysis",config:{type:"static"},position:{x:100,y:100},inputs:[],outputs:["score","threats"]},{id:"node2",type:"condition",name:"High Risk Check",config:{threshold:70},position:{x:300,y:100},inputs:["score"],outputs:["true","false"]},{id:"node3",type:"action",name:"Alert Security",config:{type:"alert",severity:"high"},position:{x:500,y:50},inputs:["trigger"],outputs:[]}],connections:[{id:"conn1",from:"node1",to:"node2",fromPort:"score",toPort:"score"},{id:"conn2",from:"node2",to:"node3",fromPort:"true",toPort:"trigger"}],createdAt:new Date,updatedAt:new Date}])},ze=()=>{localStorage.setItem("athena-workflows",JSON.stringify(o))},Ve=()=>{const t=crypto.randomUUID();fe(t),ne("New Workflow"),T([]),Q([]),H({id:t,name:"New Workflow",description:"",nodes:[],connections:[],createdAt:new Date,updatedAt:new Date}),c(!0)},Ye=()=>{const t=M(),s=oe(),e=pe();if(e&&t.length>0){const d={id:Re()||crypto.randomUUID(),name:e,description:ge.description,nodes:t,connections:s,createdAt:ge.createdAt,updatedAt:new Date},p=o.findIndex(u=>u.id===d.id);p>=0?n(p,d):n([...o,d]),ze(),c(!1)}},re=t=>{se(t)},qe=t=>{if(t.target.closest(".workflow-node"))return;const s=E();if(s&&R){const e=R.getBoundingClientRect(),d=t.clientX-e.left-75,p=t.clientY-e.top-30,u=Ee.some(i=>i.type===s.type),g=Te.some(i=>i.type===s.type),$=u?"condition":g?"action":"analysis",b={id:`node-${Date.now()}`,type:$,name:s.name,config:{type:s.type},position:{x:Math.max(0,d),y:Math.max(0,p)},inputs:Qe(s.type),outputs:Ke(s.type)};T(i=>[...i,b]),se(null)}},Ge=(t,s)=>{if(t.target.closest(".delete-node, .port"))return;t.preventDefault(),t.stopPropagation();const e=M().find(g=>g.id===s);if(!e||!R)return;const d=R.getBoundingClientRect();ve(s),Be({x:t.clientX-d.left-e.position.x,y:t.clientY-d.top-e.position.y});const p=g=>{if(!R)return;const $=be();if(!$)return;const b=R.getBoundingClientRect(),i=Ue(),w=Math.max(0,g.clientX-b.left-i.x),k=Math.max(0,g.clientY-b.top-i.y);T(A=>A.map(_=>_.id===$?{..._,position:{x:w,y:k}}:_))},u=()=>{ve(null),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",u)};document.addEventListener("mousemove",p),document.addEventListener("mouseup",u)},Z=150,ee=70,xe=(t,s)=>{const e=t.position.x,d=t.position.y;switch(s){case"top":return{x:e+Z/2,y:d};case"right":return{x:e+Z,y:d+ee/2};case"bottom":return{x:e+Z/2,y:d+ee};case"left":return{x:e,y:d+ee/2};default:return{x:e+Z,y:d+ee/2}}},Xe=ct(()=>{const t=M();return oe().map(e=>{const d=t.find(D=>D.id===e.from),p=t.find(D=>D.id===e.to);if(!d||!p)return{id:e.id,d:""};const u=xe(d,e.fromPort),g=xe(p,e.toPort),$=Math.abs(g.x-u.x),b=Math.abs(g.y-u.y),i=Math.min(50,Math.max($,b)/2);let w=u.x,k=u.y,A=g.x,_=g.y;return e.fromPort==="right"?w+=i:e.fromPort==="left"?w-=i:e.fromPort==="top"?k-=i:e.fromPort==="bottom"&&(k+=i),e.toPort==="right"?A+=i:e.toPort==="left"?A-=i:e.toPort==="top"?_-=i:e.toPort==="bottom"&&(_+=i),{id:e.id,d:`M ${u.x} ${u.y} C ${w} ${k}, ${A} ${_}, ${g.x} ${g.y}`}})}),Qe=t=>({static:[],yara:[],wasm:[],ai:["context"],network:[],behavioral:[],threshold:["value"],pattern:["data"],time:[],alert:["trigger"],quarantine:["file"],report:["data"],api:["payload"]})[t]||[],Ke=t=>({static:["score","threats","metadata"],yara:["matches","count"],wasm:["results","modules"],ai:["analysis","confidence"],network:["connections","protocols"],behavioral:["behaviors","anomalies"],threshold:["true","false"],pattern:["match","nomatch"],time:["triggered"],alert:[],quarantine:["status"],report:["url"],api:["response"]})[t]||[],Ze=t=>{me(t)},et=t=>{T(s=>s.filter(e=>e.id!==t)),Q(s=>s.filter(e=>e.from!==t&&e.to!==t)),H(Fe(s=>{s.nodes=s.nodes.filter(e=>e.id!==t),s.connections=s.connections.filter(e=>e.from!==t&&e.to!==t)})),me(null)},_e=(t,s)=>{he(!0),ye({node:t,port:s})},ke=(t,s)=>{const e=Le();if(e&&e.node!==t){const d={id:`conn-${Date.now()}`,from:e.node,to:t,fromPort:e.port,toPort:s};Q(p=>[...p,d]),H(Fe(p=>{p.connections.push(d)}))}he(!1),ye(null)},tt=async t=>{try{if(!t.nodes||t.nodes.length===0){alert("Workflow has no nodes to execute");return}if(!ae.currentFile){x("Please upload a file before executing the workflow"),alert("Please upload a file before executing the workflow");return}const e=ot(t),d={workflow_id:t.id,workflow_name:t.name,nodes:t.nodes.map(i=>({id:i.id,type:i.type,name:i.name,config:i.config})),connections:t.connections,metadata:{description:t.description,created_at:t.createdAt}};x("Starting workflow execution..."),J(0),I("starting");const p=await ce.startJob(e,d);I(p);const u=ce.onProgress(p,i=>{J(i.progress*100),x(i.message)});let g=!1,$=0;const b=120;for(;!g&&$<b;){await new Promise(i=>setTimeout(i,1e3));try{const i=await ce.getJobStatus(p);if(i.status==="Completed")g=!0,J(100),x("Workflow completed successfully!"),i.output&&alert(`Workflow completed successfully!

Results:
${JSON.stringify(i.output,null,2)}`),setTimeout(()=>{I(null),J(0),x("")},3e3);else if(i.status==="Failed"){g=!0;const w=i.error||"Unknown error occurred";x(`Workflow failed: ${w}`),alert(`Workflow execution failed:
${w}`),setTimeout(()=>{I(null),J(0),x("")},3e3)}else i.status==="Cancelled"?(g=!0,x("Workflow was cancelled"),setTimeout(()=>{I(null),J(0),x("")},3e3)):i.status==="Running"&&J(i.progress*100)}catch(i){console.error("Error checking job status:",i)}$++}u(),g||(x("Workflow execution timed out"),alert("Workflow execution timed out. Check the job status manually."),setTimeout(()=>{I(null),J(0),x("")},3e3))}catch(s){console.error("Failed to start workflow:",s);const e=s instanceof Error?s.message:"Unknown error";x(`Error: ${e}`),alert(`Failed to execute workflow:
${e}`),setTimeout(()=>{I(null),J(0),x("")},3e3)}},ot=t=>{const s=t.nodes.map(e=>{var d;return((d=e.config)==null?void 0:d.type)||e.name.toLowerCase()});return s.some(e=>["static","yara","wasm","ai"].includes(e))?"FileAnalysis":s.some(e=>e.includes("batch")||e.includes("scan"))?"BatchScan":s.some(e=>["network","behavioral","pattern"].includes(e))?"ThreatHunting":s.some(e=>e.includes("report")||e==="report")?"ReportGeneration":"FileAnalysis"};return(()=>{var t=wt(),s=t.firstChild,e=s.firstChild,d=e.nextSibling;return d.$$click=Ve,f(t,N(Y,{get when(){return!a()},get fallback(){return(()=>{var p=vt(),u=p.firstChild,g=u.firstChild,$=g.nextSibling,b=$.firstChild,i=b.nextSibling,w=u.nextSibling,k=w.firstChild,A=k.firstChild,_=A.nextSibling,D=_.nextSibling;D.firstChild;var O=D.nextSibling,ie=O.nextSibling,z=ie.nextSibling,V=z.nextSibling,P=V.nextSibling,S=k.nextSibling,L=S.firstChild;return g.$$input=r=>{ne(r.currentTarget.value),H("name",r.currentTarget.value)},b.$$click=Ye,i.$$click=()=>c(!1),f(_,(()=>{var r=dt(()=>!!E());return()=>r()?`Click canvas to place "${E().name}"`:"Click a node, then click canvas to place"})()),f(D,()=>M().length,null),f(k,N(Y,{get when(){return E()},get children(){var r=$t();return r.$$click=()=>se(null),r}}),O),f(O,N(U,{each:Ct,children:r=>(()=>{var l=de(),h=l.firstChild,C=h.nextSibling;return l.$$click=()=>re(r),f(h,()=>r.icon),f(C,()=>r.name),F(()=>{var y;return G(l,`palette-node ${((y=E())==null?void 0:y.type)===r.type?"selected":""}`)}),l})()})),f(z,N(U,{each:Ee,children:r=>(()=>{var l=de(),h=l.firstChild,C=h.nextSibling;return l.$$click=()=>re(r),f(h,()=>r.icon),f(C,()=>r.name),F(()=>{var y;return G(l,`palette-node condition ${((y=E())==null?void 0:y.type)===r.type?"selected":""}`)}),l})()})),f(P,N(U,{each:Te,children:r=>(()=>{var l=de(),h=l.firstChild,C=h.nextSibling;return l.$$click=()=>re(r),f(h,()=>r.icon),f(C,()=>r.name),F(()=>{var y;return G(l,`palette-node action ${((y=E())==null?void 0:y.type)===r.type?"selected":""}`)}),l})()})),S.$$click=qe,ut(r=>{R=r},S),f(L,N(U,{get each(){return Xe()},children:r=>N(Y,{get when(){return r.d},get children(){var l=xt();return F(()=>De(l,"d",r.d)),l}})})),f(S,N(U,{get each(){return M()},children:r=>(()=>{var l=_t(),h=l.firstChild,C=h.nextSibling,y=C.nextSibling,Se=y.nextSibling,Ce=Se.nextSibling,Ne=Ce.firstChild,nt=Ne.nextSibling,st=Ce.nextSibling,rt=st.firstChild;return l.$$click=()=>Ze(r),l.$$mousedown=m=>Ge(m,r.id),q(l,"position","absolute"),q(l,"cursor","move"),h.$$click=m=>{m.stopPropagation(),_e(r.id,"top")},C.$$click=m=>{m.stopPropagation(),_e(r.id,"right")},y.$$click=m=>{m.stopPropagation(),ke(r.id,"bottom")},Se.$$click=m=>{m.stopPropagation(),ke(r.id,"left")},f(Ne,()=>r.name),nt.$$click=m=>{m.stopPropagation(),et(r.id)},f(rt,()=>r.type),F(m=>{var We;var Ae=`workflow-node ${((We=K())==null?void 0:We.id)===r.id?"selected":""} ${be()===r.id?"dragging":""}`,Pe=`${r.position.x}px`,je=`${r.position.y}px`;return Ae!==m.e&&G(l,m.e=Ae),Pe!==m.t&&q(l,"left",m.t=Pe),je!==m.a&&q(l,"top",m.a=je),m},{e:void 0,t:void 0,a:void 0}),l})()}),null),f(w,N(Y,{get when(){return K()},get children(){var r=bt(),l=r.firstChild,h=l.nextSibling;h.firstChild;var C=h.nextSibling;return f(h,()=>{var y;return(y=K())==null?void 0:y.name},null),f(C,()=>{var y;return JSON.stringify((y=K())==null?void 0:y.config,null,2)}),r}}),null),F(()=>G(S,`workflow-canvas ${E()?"placing-node":""}`)),F(()=>g.value=pe()),p})()},get children(){var p=yt();return f(p,N(U,{each:o,children:u=>(()=>{var g=St(),$=g.firstChild,b=$.nextSibling,i=b.nextSibling,w=i.firstChild,k=w.firstChild,A=k.nextSibling;A.nextSibling;var _=w.nextSibling,D=_.firstChild,O=D.nextSibling;O.nextSibling;var ie=i.nextSibling,z=ie.firstChild,V=z.nextSibling;return f($,()=>u.name),f(b,()=>u.description),f(w,()=>u.nodes.length,A),f(_,()=>u.connections.length,O),z.$$click=()=>{fe(u.id),ne(u.name),T([...u.nodes]),Q([...u.connections]),H(u),c(!0)},V.$$click=()=>tt(u),f(g,N(Y,{get when(){return we()},get children(){var P=kt(),S=P.firstChild,L=S.nextSibling,r=L.firstChild,l=L.nextSibling,h=l.firstChild;return f(S,()=>Oe()||"Initializing..."),f(l,()=>Math.round($e()),h),F(C=>q(r,"width",`${$e()}%`)),P}}),null),F(P=>{var S=we()!==null||!ae.currentFile,L=ae.currentFile?"":"Please upload a file first";return S!==P.e&&(V.disabled=P.e=S),L!==P.t&&De(V,"title",P.t=L),P},{e:void 0,t:void 0}),g})()})),p}}),null),t})()};pt(["click","input","mousedown"]);export{Wt as default};
