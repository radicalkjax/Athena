var Ne=Object.defineProperty;var je=(n,e,t)=>e in n?Ne(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ee=(n,e,t)=>je(n,typeof e!="symbol"?e+"":e,t);import{t as E,i as m,a as D,F as re,b as h,d as se,c as y,u as te,o as Re,f as ze,l as P,e as Be,v as Je,h as _e,j as we,S as q,s as Ue,m as Ve,g as qe}from"./vendor-solid-B-ykKXyV.js";import{s as Ke,o as Ye,i as K}from"./vendor-BrNNPIVf.js";import{i as z,p as ae,a as Se}from"./index-UCtE3PH6.js";class Ge{constructor(){ee(this,"templates",new Map);ee(this,"exportHistory",[]);this.initializeDefaultTemplates()}initializeDefaultTemplates(){[{id:"malware-ioc",name:"IoC Export",description:"Export indicators of compromise",format:"json",sections:["hashes","ips","domains","files","registry","yara_matches"]},{id:"executive-report",name:"Executive Report",description:"High-level summary for management",format:"pdf",sections:["summary","risk_assessment","recommendations","timeline"]},{id:"technical-analysis",name:"Technical Deep Dive",description:"Detailed technical analysis",format:"html",sections:["static_analysis","dynamic_analysis","code_analysis","network_analysis","memory_analysis"]},{id:"forensics-timeline",name:"Forensics Timeline",description:"Chronological event timeline",format:"csv",sections:["events","processes","network_connections","file_operations"]},{id:"mitre-mapping",name:"MITRE ATT&CK Mapping",description:"Map to MITRE framework",format:"json",sections:["techniques","tactics","mitigations","detections"]}].forEach(t=>{this.templates.set(t.id,t)})}async exportAnalysis(e,t,i){var r;try{const s=await this.prepareExportData(t,i),l=await Ke({defaultPath:`athena_export_${e}_${Date.now()}.${i.format}`,filters:[{name:i.format.toUpperCase(),extensions:[i.format]}]});if(!l)throw new Error("Export cancelled by user");let d=s;return(r=i.encryption)!=null&&r.enabled&&(d=await this.encryptData(s,i.encryption.password)),i.compression&&(d=await this.compressData(d)),await this.writeExportFile(l,d,i.format),this.exportHistory.push({timestamp:Date.now(),fileId:e,format:i.format,success:!0}),l}catch(s){throw this.exportHistory.push({timestamp:Date.now(),fileId:e,format:i.format,success:!1}),s}}async batchExport(e,t){const i=[],r=[],s=t.outputDirectory||await Ye({directory:!0,multiple:!1,title:"Select Export Directory"});if(!s)throw new Error("Batch export cancelled by user");for(const[l,d]of t.fileIds.entries())try{const g=e.get(d);if(!g){r.push({fileId:d,error:"Analysis data not found"});continue}let u;switch(t.naming){case"sequential":u=`export_${l+1}.${t.format}`;break;case"custom":u=this.applyNamingPattern(t.customNamingPattern||"export_{index}",{index:l+1,fileId:d,timestamp:Date.now()})+`.${t.format}`;break;default:u=`${d}_export.${t.format}`}const C=`${s}/${u}`,A={format:t.format,template:t.template,includeMetadata:t.includeMetadata,compression:t.compression,encryption:t.encryption};await this.exportAnalysis(d,g,A),i.push(C)}catch(g){r.push({fileId:d,error:g instanceof Error?g.message:"Unknown error"})}return await this.createBatchSummary(s,i,r),r.length>0&&console.warn("Batch export completed with errors:",r),i}async prepareExportData(e,t){const i=t.template?this.templates.get(t.template):null;let r={metadata:{exportDate:new Date().toISOString(),version:"1.0",tool:"Athena Security Platform"}};if(i)for(const s of i.sections)e[s]&&(r[s]=e[s]);else r={...r,...e};return t.includeMetadata||delete r.metadata,r}async writeExportFile(e,t,i){switch(i){case"json":await z("write_file_text",{path:e,content:JSON.stringify(t,null,2)});break;case"csv":const r=await this.convertToCSV(t);await z("write_file_text",{path:e,content:r});break;case"html":const s=await this.generateHTMLReport(t);await z("write_file_text",{path:e,content:s});break;case"pdf":await K("generate_pdf_report",{data:t,outputPath:e});break;case"xlsx":await K("generate_excel_report",{data:t,outputPath:e});break;case"encrypted":await z("write_file_text",{path:e,content:t});break;default:throw new Error(`Unsupported export format: ${i}`)}}async convertToCSV(e){const t=(l,d="")=>Object.keys(l).reduce((g,u)=>{const C=d?`${d}.${u}`:u;return typeof l[u]=="object"&&l[u]!==null&&!Array.isArray(l[u])?Object.assign(g,t(l[u],C)):g[C]=l[u],g},{}),i=t(e),r=Object.keys(i),s=Object.values(i).map(l=>typeof l=="string"?`"${l.replace(/"/g,'""')}"`:l);return`${r.join(",")}
${s.join(",")}`}async generateHTMLReport(e){return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athena Security Analysis Report</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #0a0e27; 
            color: #e0e0e0; 
            padding: 40px;
            line-height: 1.6;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: #1a1a1a; 
            border-radius: 12px; 
            padding: 40px;
            box-shadow: 0 0 40px rgba(255, 107, 157, 0.1);
        }
        h1 { 
            color: #ff6b9d; 
            border-bottom: 3px solid #ff6b9d; 
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        h2 { 
            color: #ff6b9d; 
            margin-top: 40px;
            margin-bottom: 20px;
        }
        .section { 
            background: #2a2a2a; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            border: 1px solid #444;
        }
        .metric { 
            display: inline-block; 
            background: #3a3a3a; 
            padding: 10px 20px; 
            border-radius: 6px; 
            margin: 5px;
            border: 1px solid #555;
        }
        .severity-high { color: #ef4444; }
        .severity-medium { color: #fb923c; }
        .severity-low { color: #fbbf24; }
        pre { 
            background: #0a0e27; 
            padding: 15px; 
            border-radius: 6px; 
            overflow-x: auto;
            border: 1px solid #333;
        }
        code { 
            color: #48dbfb; 
            font-family: 'JetBrains Mono', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è Athena Security Analysis Report</h1>
        ${this.generateHTMLContent(e)}
    </div>
</body>
</html>`}generateHTMLContent(e){let t="";for(const[i,r]of Object.entries(e))i!=="metadata"&&(t+='<div class="section">',t+=`<h2>${this.formatSectionTitle(i)}</h2>`,Array.isArray(r)?(t+="<ul>",r.forEach(s=>{t+=`<li>${this.formatValue(s)}</li>`}),t+="</ul>"):typeof r=="object"?t+="<pre><code>"+JSON.stringify(r,null,2)+"</code></pre>":t+=`<p>${this.formatValue(r)}</p>`,t+="</div>");return t}formatSectionTitle(e){return e.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}formatValue(e){return typeof e=="object"?JSON.stringify(e):String(e)}async encryptData(e,t){return await K("encrypt_export_data",{data:JSON.stringify(e),password:t})}async compressData(e){return await K("compress_export_data",{data:e})}applyNamingPattern(e,t){return e.replace(/{(\w+)}/g,(i,r)=>t[r]||i)}async createBatchSummary(e,t,i){const r={timestamp:new Date().toISOString(),totalFiles:t.length+i.length,successful:t.length,failed:i.length,exportedFiles:t,errors:i};await z("write_file_text",{path:`${e}/batch_export_summary.json`,content:JSON.stringify(r,null,2)})}addCustomTemplate(e){this.templates.set(e.id,e),this.saveTemplates()}removeTemplate(e){const t=this.templates.delete(e);return t&&this.saveTemplates(),t}getTemplates(){return Array.from(this.templates.values())}getTemplate(e){return this.templates.get(e)}saveTemplates(){const e=Array.from(this.templates.entries()).filter(([t])=>!this.isDefaultTemplate(t)).map(([t,i])=>i);localStorage.setItem("athena_export_templates",JSON.stringify(e))}isDefaultTemplate(e){return["malware-ioc","executive-report","technical-analysis","forensics-timeline","mitre-mapping"].includes(e)}getExportHistory(){return[...this.exportHistory]}clearExportHistory(){this.exportHistory=[]}}const ie=new Ge;var Ee=E("<div>"),Qe=E("<div><div>");function We(n){const e=n.itemHeight||ae.virtualScrolling.itemHeight,t=n.overscan||ae.virtualScrolling.overscan,i=n.threshold||ae.virtualScrolling.threshold;if(n.items.length<i)return(()=>{var c=Ee();return m(c,D(re,{get each(){return n.items},children:(b,T)=>n.renderItem(b,T())})),h(()=>se(c,n.class)),c})();let r;const[s,l]=y(0),[d,g]=y(0),u=te(()=>{const c=Math.floor(s()/e),b=Math.ceil((s()+d())/e);return{start:Math.max(0,c-t),end:Math.min(n.items.length-1,b+t)}}),C=te(()=>{const{start:c,end:b}=u();return n.items.slice(c,b+1).map((T,x)=>({item:T,index:c+x,style:{position:"absolute",top:`${(c+x)*e}px`,height:`${e}px`,width:"100%"}}))}),A=te(()=>n.items.length*e),Y=()=>{r&&l(r.scrollTop)},H=()=>{r&&g(r.clientHeight)};return Re(()=>{H(),window.addEventListener("resize",H)}),ze(()=>{window.removeEventListener("resize",H)}),(()=>{var c=Qe(),b=c.firstChild;c.addEventListener("scroll",Y);var T=r;return typeof T=="function"?Je(T,c):r=c,P(c,"position","relative"),P(c,"overflow","auto"),P(c,"height","100%"),P(b,"position","relative"),m(b,D(re,{get each(){return C()},children:({item:x,index:I,style:L})=>(()=>{var $=Ee();return m($,()=>n.renderItem(x,I)),h(G=>Be($,L,G)),$})()})),h(x=>{var I=`virtual-list-container ${n.class||""}`,L=`${A()}px`;return I!==x.e&&se(c,x.e=I),L!==x.t&&P(b,"height",x.t=L),x},{e:void 0,t:void 0}),c})()}var Xe=E("<div class=option-group><label>Naming Pattern</label><input type=text placeholder=export_{index}_{timestamp}><small>Available variables: {index}, {fileId}, {timestamp}"),Ze=E('<div class=option-group><label>Encryption Password</label><div class=password-input><input placeholder="Enter strong password"><button type=button class=toggle-password>'),et=E("<div style=color:var(--warning-color);margin-top:10px;text-align:center>This is taking longer than usual. Large exports or encryption may take extra time."),tt=E("<div class=export-progress><div class=progress-bar><div class=progress-fill></div></div><div class=progress-info><span class=progress-text>%</span><span class=progress-status>"),at=E('<div class=batch-export-modal><div class=batch-export-container><div class=batch-export-header><h2>Batch Export Analysis Results</h2><button class=close-button>‚úï</button></div><div class=batch-export-content><div class=export-section><h3>Select Files to Export</h3><div class=selection-controls><button>Select All</button><button>Deselect All</button><span class=selection-count> files selected</span></div><div class=file-list></div></div><div class=export-section><h3>Export Options</h3><div class=option-group><label>Export Format</label><select><option value=json>JSON</option><option value=csv>CSV</option><option value=html>HTML Report</option><option value=pdf>PDF Report</option><option value=xlsx>Excel Spreadsheet</option><option value=encrypted>Encrypted Archive</option></select></div><div class=option-group><label>Export Template</label><select><option value>No Template</option></select></div><div class=option-group><label>File Naming</label><select><option value=original>Original Filename</option><option value=sequential>Sequential (export_1, export_2...)</option><option value=custom>Custom Pattern</option></select></div><div class="option-group checkbox-group"><label><input type=checkbox>Include Metadata</label><label><input type=checkbox>Compress Files</label><label><input type=checkbox>Encrypt Export</label></div></div></div><div class=batch-export-footer><button class=cancel-button>Cancel</button><button class=export-button>'),it=E("<div><input type=checkbox><div class=file-info><div class=file-name></div><div class=file-meta> ‚Ä¢ <!> results"),rt=E("<option>");const ct=n=>{const[e,t]=_e(new Set),[i,r]=_e({format:"json",includeMetadata:!0,compression:!1,encryption:{enabled:!1}}),[s,l]=y(!1),[d,g]=y(0),[u,C]=y(""),[A,Y]=y("original"),[H,c]=y("export_{index}_{timestamp}"),[b,T]=y(""),[x,I]=y(!1),[L,$]=y(""),[G,ne]=y(!1),Ce=ie.getTemplates(),le=()=>Se.files().filter(o=>o.status==="completed").map(o=>({fileId:o.id,fileName:o.name,timestamp:o.uploadedAt,resultCount:o.results?Object.keys(o.results).length:0})),oe=f=>{const o=new Set(e);o.has(f)?o.delete(f):o.add(f),t(o)},Te=()=>{const f=le().map(o=>o.fileId);t(new Set(f))},ke=()=>{t(new Set)},De=f=>{C(f);const o=ie.getTemplate(f);o&&r("format",o.format)},Pe=async()=>{var o,N;if(e.size===0){alert("Please select at least one file to export");return}if((o=i.encryption)!=null&&o.enabled&&!b()){alert("Please enter an encryption password");return}l(!0),g(0),$("Preparing export..."),ne(!1);const f=setTimeout(()=>{ne(!0),$("Export is taking longer than expected. Please wait...")},3e4);try{const _=new Map,k=Array.from(e);if($("Collecting file data..."),k.forEach((M,B)=>{const O=Se.files().find(J=>J.id===M);O!=null&&O.results&&_.set(M,O.results),g((B+1)/k.length*50)}),_.size===0){clearTimeout(f),alert("No analysis data found for selected files. Please analyze files first.");return}$(`Exporting ${_.size} files...`);const j={...i,fileIds:k,naming:A(),customNamingPattern:H(),template:u(),encryption:(N=i.encryption)!=null&&N.enabled?{enabled:!0,password:b()}:{enabled:!1}},R=await ie.batchExport(_,j);clearTimeout(f),g(100),$("Export complete!"),setTimeout(()=>{var M;alert(`Successfully exported ${R.length} files to:
${R[0]||"export directory"}`),(M=n.onClose)==null||M.call(n)},500)}catch(_){clearTimeout(f),console.error("Batch export failed:",_);const k=_ instanceof Error?_.message:"Unknown error occurred";$(`Export failed: ${k}`),alert(`Export failed: ${k}

Please check:
- File permissions
- Available disk space
- Export format compatibility`)}finally{l(!1)}};return(()=>{var f=at(),o=f.firstChild,N=o.firstChild,_=N.firstChild,k=_.nextSibling,j=N.nextSibling,R=j.firstChild,M=R.firstChild,B=M.nextSibling,O=B.firstChild,J=O.nextSibling,ce=J.nextSibling,Ae=ce.firstChild,de=B.nextSibling,Q=R.nextSibling,Me=Q.firstChild,pe=Me.nextSibling,Oe=pe.firstChild,me=Oe.nextSibling,ue=pe.nextSibling,Fe=ue.firstChild,U=Fe.nextSibling;U.firstChild;var he=ue.nextSibling,He=he.firstChild,fe=He.nextSibling,ge=he.nextSibling,xe=ge.firstChild,ve=xe.firstChild,be=xe.nextSibling,ye=be.firstChild,Ie=be.nextSibling,$e=Ie.firstChild,Le=j.nextSibling,W=Le.firstChild,X=W.nextSibling;return we(k,"click",n.onClose),O.$$click=Te,J.$$click=ke,m(ce,()=>e.size,Ae),P(de,"height","300px"),m(de,D(We,{get items(){return le()},itemHeight:60,overscan:5,renderItem:a=>(()=>{var p=it(),v=p.firstChild,w=v.nextSibling,S=w.firstChild,F=S.nextSibling,V=F.firstChild,Z=V.nextSibling;return Z.nextSibling,p.$$click=()=>oe(a.fileId),v.addEventListener("change",()=>oe(a.fileId)),m(S,()=>a.fileName),m(F,()=>new Date(a.timestamp).toLocaleDateString(),V),m(F,()=>a.resultCount,Z),h(()=>se(p,`file-item ${e.has(a.fileId)?"selected":""}`)),h(()=>v.checked=e.has(a.fileId)),p})()})),me.addEventListener("change",a=>r("format",a.currentTarget.value)),U.addEventListener("change",a=>De(a.currentTarget.value)),m(U,D(re,{each:Ce,children:a=>(()=>{var p=rt();return m(p,()=>a.name),h(()=>p.value=a.id),p})()}),null),fe.addEventListener("change",a=>Y(a.currentTarget.value)),m(Q,D(q,{get when(){return A()==="custom"},get children(){var a=Xe(),p=a.firstChild,v=p.nextSibling;return v.$$input=w=>c(w.currentTarget.value),h(()=>v.value=H()),a}}),ge),ve.addEventListener("change",a=>r("includeMetadata",a.currentTarget.checked)),ye.addEventListener("change",a=>r("compression",a.currentTarget.checked)),$e.addEventListener("change",a=>r("encryption",{enabled:a.currentTarget.checked})),m(Q,D(q,{get when(){var a;return(a=i.encryption)==null?void 0:a.enabled},get children(){var a=Ze(),p=a.firstChild,v=p.nextSibling,w=v.firstChild,S=w.nextSibling;return w.$$input=F=>T(F.currentTarget.value),S.$$click=()=>I(!x()),m(S,()=>x()?"üëÅÔ∏è":"üëÅÔ∏è‚Äçüó®Ô∏è"),h(()=>Ue(w,"type",x()?"text":"password")),h(()=>w.value=b()),a}}),null),m(j,D(q,{get when(){return s()},get children(){var a=tt(),p=a.firstChild,v=p.firstChild,w=p.nextSibling,S=w.firstChild,F=S.firstChild,V=S.nextSibling;return P(v,"transition","width 0.3s ease"),m(S,()=>d().toFixed(0),F),m(V,L),m(a,D(q,{get when(){return G()},get children(){return et()}}),null),h(Z=>P(v,"width",`${d()}%`)),a}}),null),we(W,"click",n.onClose),X.$$click=Pe,m(X,(()=>{var a=Ve(()=>!!s());return()=>a()?"Exporting...":`Export ${e.size} Files`})()),h(a=>{var p=s(),v=e.size===0||s();return p!==a.e&&(W.disabled=a.e=p),v!==a.t&&(X.disabled=a.t=v),a},{e:void 0,t:void 0}),h(()=>me.value=i.format),h(()=>U.value=u()),h(()=>fe.value=A()),h(()=>ve.checked=i.includeMetadata),h(()=>ye.checked=i.compression),h(()=>{var a;return $e.checked=((a=i.encryption)==null?void 0:a.enabled)??!1}),f})()};qe(["click","input"]);export{ct as default};
