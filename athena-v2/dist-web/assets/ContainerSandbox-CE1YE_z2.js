import{c as I,q as ie,f as oe,t as h,i as c,m as L,b as w,a as se,s as R,d as le,F as ce,g as de}from"./vendor-solid-B-ykKXyV.js";import{i as F}from"./vendor-BrNNPIVf.js";const H=new Set(["file","strings","hexdump","xxd","readelf","objdump","nm","ldd","cat","ls","head","tail","stat","md5sum","sha256sum","sha1sum","ps","strace","ltrace","tcpdump","netstat","upx","yara"]);function ue(a){if(!a||a.length===0)throw new Error("Command cannot be empty");const n=a[0],s=n.split("/").pop()||n;if(!H.has(s))throw new Error(`Command '${s}' is not in the allowed whitelist. Allowed commands: ${Array.from(H).join(", ")}`);const p=[/[;&|`$(){}]/,/\$\(/,/`/,/>\s*\//,/\|\s*\w+/];for(let g=1;g<a.length;g++){const S=a[g];for(const C of p)if(C.test(S))throw new Error(`Argument '${S}' contains potentially dangerous shell metacharacters`)}}class A{static async checkDockerAvailable(){try{return await F("check_docker_available")}catch(n){return console.error("Failed to check Docker availability:",n),!1}}static async createSandboxContainer(n,s,p){try{return await F("create_sandbox_container",{image:n,memoryLimit:s,cpuLimit:p})}catch(g){throw console.error("Failed to create sandbox container:",g),new Error(`Container creation failed: ${g}`)}}static async executeInContainer(n,s,p){ue(s);try{return await F("execute_in_container",{containerId:n,command:s,timeoutSecs:p})}catch(g){throw console.error("Failed to execute command in container:",g),new Error(`Command execution failed: ${g}`)}}static async stopContainer(n){try{await F("stop_container",{containerId:n})}catch(s){throw console.error("Failed to stop container:",s),new Error(`Container stop failed: ${s}`)}}static async removeContainer(n){try{await F("remove_container",{containerId:n})}catch(s){throw console.error("Failed to remove container:",s),new Error(`Container removal failed: ${s}`)}}static async listSandboxContainers(){try{return await F("list_sandbox_containers")}catch(n){throw console.error("Failed to list containers:",n),new Error(`Container listing failed: ${n}`)}}static async getContainerLogs(n){try{return await F("get_container_logs",{containerId:n})}catch(s){throw console.error("Failed to get container logs:",s),new Error(`Log retrieval failed: ${s}`)}}static async analyzeFileInSandbox(n,s="alpine:latest",p=256*1024*1024,g=.5,S=300){let C=null;try{const v=await this.createSandboxContainer(s,p,g);C=v.id;const k=await this.executeInContainer(C,["file",n],S);return{container:v,result:k}}finally{if(C)try{await this.removeContainer(C)}catch(v){console.warn("Failed to cleanup container:",v)}}}static async runMalwareAnalysis(n,s,p=300){const g="ubuntu:latest";let v=null;try{v=(await this.createSandboxContainer(g,536870912,1)).id;const T=await this.executeInContainer(v,["file",n],30);let E=T;return s.length>0&&(E=await this.executeInContainer(v,s,p),E.stdout=`=== File Analysis ===
${T.stdout}

=== Script Analysis ===
${E.stdout}`),E}finally{if(v)try{await this.removeContainer(v)}catch(k){console.warn("Failed to cleanup analysis container:",k)}}}}var ge=h("<div class=container-sandbox><h2>Docker Container Sandbox"),me=h("<p>Checking Docker availability..."),$e=h('<div class="alert alert-error"><strong>Docker Not Available</strong><p>Docker is required for container sandboxing. Please ensure Docker Desktop is running.'),be=h("<div class=card><h3>Create Sandbox Container</h3><div class=form-group><label>Docker Image:</label><input type=text placeholder=alpine:latest></div><div class=form-group><label>Memory Limit (MB):</label><input type=number min=64 max=4096></div><div class=form-group><label>CPU Limit (0.1 - 4.0):</label><input type=number step=0.1 min=0.1 max=4.0></div><button>"),he=h("<div class=card><h3>Running Containers (<!>)</h3><div class=container-list>"),ve=h("<div class=card><h3>Execution Logs</h3><pre class=logs-output></pre><button>Clear Logs"),fe=h('<div class=card><h3>Execute Command</h3><p>Container: <code></code></p><div class=form-group><label>Command:</label><input type=text placeholder="ls -la"></div><div class=form-group><label>Timeout (seconds):</label><input type=number min=1 max=300></div><button>'),pe=h("<p>No containers running"),Ce=h('<div class=container-item><div class=container-info><div class=container-header><strong></strong><span class=container-id></span></div><div class=container-details><span class=container-image></span><span></span><span class=container-created></span></div></div><div class=container-actions><button class=btn-small>Select</button><button class="btn-small btn-info">View Logs'),_e=h('<button class="btn-small btn-warning">Stop'),xe=h('<button class="btn-small btn-danger">Remove'),we=h("<div class=card id=container-logs-viewer><div class=logs-header><h3>Container Logs - </h3><div class=logs-actions><button class=btn-small>Copy Logs</button><button class=btn-small>Close"),ye=h("<div class=logs-loading>Loading logs..."),Le=h('<pre class="logs-output logs-container-viewer">');const Ee=()=>{const[a,n]=I({dockerAvailable:!1,checking:!0,containers:[],logs:"",executing:!1,containerLogs:"",loadingLogs:!1}),[s,p]=I(""),[g,S]=I("alpine:latest"),[C,v]=I(256),[k,T]=I(.5),[E,j]=I(30);ie(async()=>{try{const t=await A.checkDockerAvailable();n(r=>({...r,dockerAvailable:t,checking:!1})),t&&await M()}catch(t){console.error("Failed to check Docker:",t),n(r=>({...r,checking:!1}))}});const J=setInterval(async()=>{a().dockerAvailable&&await M()},5e3);oe(()=>{clearInterval(J)});const M=async()=>{try{const t=await A.listSandboxContainers();n(r=>({...r,containers:t}))}catch(t){console.error("Failed to list containers:",t)}},K=async()=>{try{n(r=>({...r,executing:!0}));const t=await A.createSandboxContainer(g(),C()*1024*1024,k());n(r=>({...r,selectedContainer:t,logs:`Container created: ${t.id}
`})),await M()}catch(t){console.error("Failed to create container:",t),n(r=>({...r,logs:r.logs+`Error: ${t}
`}))}finally{n(t=>({...t,executing:!1}))}},q=async()=>{const t=a().selectedContainer;if(!t){alert("Please create a container first");return}const r=s().trim();if(!r){alert("Please enter a command");return}try{n(l=>({...l,executing:!0}));const e=r.split(" ").filter(l=>l.length>0),i=await A.executeInContainer(t.id,e,E());n(l=>({...l,lastResult:i,logs:l.logs+`
$ ${r}
Exit code: ${i.exit_code}
Time: ${i.execution_time_ms}ms
Output:
${i.stdout}
`+(i.stderr?`Errors:
${i.stderr}
`:"")}))}catch(e){console.error("Failed to execute command:",e),n(i=>({...i,logs:i.logs+`Error: ${e}
`}))}finally{n(e=>({...e,executing:!1}))}},Q=async t=>{try{await A.stopContainer(t),n(r=>({...r,logs:r.logs+`Container ${t.substring(0,12)} stopped
`})),await M()}catch(r){console.error("Failed to stop container:",r),n(e=>({...e,logs:e.logs+`Error stopping container: ${r}
`}))}},X=async t=>{const r=t.substring(0,12);if(confirm(`Are you sure you want to remove container ${r}?`))try{await A.removeContainer(t),n(e=>{var i;return{...e,logs:e.logs+`Container ${r} removed
`,selectedContainer:((i=e.selectedContainer)==null?void 0:i.id)===t?void 0:e.selectedContainer,viewingLogsFor:e.viewingLogsFor===t?void 0:e.viewingLogsFor}}),await M()}catch(e){console.error("Failed to remove container:",e),n(i=>({...i,logs:i.logs+`Error removing container: ${e}
`}))}},Y=async t=>{try{n(e=>({...e,loadingLogs:!0,viewingLogsFor:t}));const r=await A.getContainerLogs(t);n(e=>({...e,containerLogs:r||"No logs available",loadingLogs:!1})),j(()=>{const e=document.getElementById("container-logs-viewer");e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})},100)}catch(r){console.error("Failed to get logs:",r),n(e=>({...e,containerLogs:`Error loading logs: ${r}`,loadingLogs:!1}))}},Z=()=>{n(t=>({...t,viewingLogsFor:void 0,containerLogs:""}))},ee=()=>{navigator.clipboard.writeText(a().containerLogs).then(()=>alert("Logs copied to clipboard")).catch(t=>console.error("Failed to copy logs:",t))},te=t=>{const r=new Date(t*1e3),i=new Date().getTime()-r.getTime(),l=Math.floor(i/1e3),$=Math.floor(l/60),m=Math.floor($/60),o=Math.floor(m/24);return o>0?`${o}d ago`:m>0?`${m}h ago`:$>0?`${$}m ago`:`${l}s ago`},ne=t=>{const r=t.toLowerCase();return r.includes("running")||r.includes("up")?"status-running":r.includes("exited")?"status-exited":r.includes("created")?"status-created":"status-stopped"};return(()=>{var t=ge();return t.firstChild,c(t,(()=>{var r=L(()=>!!a().checking);return()=>r()&&me()})(),null),c(t,(()=>{var r=L(()=>!a().checking&&!a().dockerAvailable);return()=>r()&&$e()})(),null),c(t,(()=>{var r=L(()=>!!a().dockerAvailable);return()=>r()&&[(()=>{var e=be(),i=e.firstChild,l=i.nextSibling,$=l.firstChild,m=$.nextSibling,o=l.nextSibling,f=o.firstChild,b=f.nextSibling,_=o.nextSibling,D=_.firstChild,y=D.nextSibling,x=_.nextSibling;return m.$$input=d=>S(d.currentTarget.value),b.$$input=d=>v(parseInt(d.currentTarget.value)||256),y.$$input=d=>T(parseFloat(d.currentTarget.value)||.5),x.$$click=K,c(x,()=>a().executing?"Creating...":"Create Container"),w(()=>x.disabled=a().executing),w(()=>m.value=g()),w(()=>b.value=C()),w(()=>y.value=k()),e})(),L(()=>L(()=>!!a().selectedContainer)()&&(()=>{var e=fe(),i=e.firstChild,l=i.nextSibling,$=l.firstChild,m=$.nextSibling,o=l.nextSibling,f=o.firstChild,b=f.nextSibling,_=o.nextSibling,D=_.firstChild,y=D.nextSibling,x=_.nextSibling;return c(m,()=>{var d;return(d=a().selectedContainer)==null?void 0:d.name}),b.addEventListener("keypress",d=>d.key==="Enter"&&q()),b.$$input=d=>p(d.currentTarget.value),y.$$input=d=>j(parseInt(d.currentTarget.value)||30),x.$$click=q,c(x,()=>a().executing?"Executing...":"Execute"),w(()=>x.disabled=a().executing||!s().trim()),w(()=>b.value=s()),w(()=>y.value=E()),e})()),(()=>{var e=he(),i=e.firstChild,l=i.firstChild,$=l.nextSibling;$.nextSibling;var m=i.nextSibling;return c(i,()=>a().containers.length,$),c(m,se(ce,{get each(){return a().containers},get fallback(){return pe()},children:o=>{const f=o.status.toLowerCase().includes("running")||o.status.toLowerCase().includes("up"),b=o.status.toLowerCase().includes("exited")||o.status.toLowerCase().includes("created");return(()=>{var _=Ce(),D=_.firstChild,y=D.firstChild,x=y.firstChild,d=x.nextSibling,re=y.nextSibling,P=re.firstChild,B=P.nextSibling,V=B.nextSibling,O=D.nextSibling,N=O.firstChild,ae=N.nextSibling;return c(x,()=>o.name),c(d,()=>o.id.substring(0,12)),c(P,()=>o.image),c(B,()=>o.status),c(V,()=>te(o.created)),N.$$click=()=>n(u=>({...u,selectedContainer:o})),N.disabled=!f,R(N,"title",f?"Select this container for command execution":"Container must be running"),ae.$$click=()=>Y(o.id),c(O,f&&(()=>{var u=_e();return u.$$click=()=>Q(o.id),u})(),null),c(O,b&&(()=>{var u=xe();return u.$$click=()=>X(o.id),u})(),null),w(u=>{var z=o.id,U=o.image,W=`container-status ${ne(o.status)}`,G=new Date(o.created*1e3).toLocaleString();return z!==u.e&&R(d,"title",u.e=z),U!==u.t&&R(P,"title",u.t=U),W!==u.a&&le(B,u.a=W),G!==u.o&&R(V,"title",u.o=G),u},{e:void 0,t:void 0,a:void 0,o:void 0}),_})()}})),e})(),L(()=>L(()=>!!a().viewingLogsFor)()&&(()=>{var e=we(),i=e.firstChild,l=i.firstChild;l.firstChild;var $=l.nextSibling,m=$.firstChild,o=m.nextSibling;return c(l,()=>{var f,b;return((f=a().containers.find(_=>_.id===a().viewingLogsFor))==null?void 0:f.name)||((b=a().viewingLogsFor)==null?void 0:b.substring(0,12))},null),m.$$click=ee,o.$$click=Z,c(e,(()=>{var f=L(()=>!!a().loadingLogs);return()=>f()?ye():(()=>{var b=Le();return c(b,()=>a().containerLogs),b})()})(),null),w(()=>m.disabled=a().loadingLogs),e})()),(()=>{var e=ve(),i=e.firstChild,l=i.nextSibling,$=l.nextSibling;return c(l,()=>a().logs||"No logs yet..."),$.$$click=()=>n(m=>({...m,logs:""})),e})()]})(),null),t})()};de(["input","click"]);export{Ee as default};
